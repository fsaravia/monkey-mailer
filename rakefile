require File.join(File.dirname(__FILE__), 'lib', 'monkey-mailer')

namespace :db do
  task :setup do
    require_relative 'lib/monkey-mailer/loaders/database'
    raise "MonkeyMailer loader is not database" unless MonkeyMailer.loader.is_a?(MonkeyMailer::Database)
    MonkeyMailer.configuration.databases.each_key do |database|
      DataMapper::Model.descendants.each do |model|
        model.auto_migrate!(database.to_sym)
      end
      puts "Database #{database} has been setup"
    end
  end
end