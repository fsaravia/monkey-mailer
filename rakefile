require File.join(File.dirname(__FILE__), 'lib', 'postman')

namespace :db do
  task :setup do
    require_relative 'lib/postman/loaders/database'
    raise "Postman loader is not database" unless Postman.loader.is_a?(Postman::Database)
    Postman.configuration.databases.each_key do |database|
      DataMapper::Model.descendants.each do |model|
        model.auto_migrate!(database.to_sym)
      end
      puts "Database #{database} has been setup"
    end
  end
end